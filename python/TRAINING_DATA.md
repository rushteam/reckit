# 训练数据说明

本文档详细说明训练数据的格式、特征定义以及预测目标。

## 训练数据格式

训练数据采用 **CSV 格式**，包含特征列和标签列。

### 特征列（7个，带前缀，与 EnrichNode / RPCNode 默认不 strip 时一致）

#### 1. 物品特征（item_*）
- **`item_ctr`** (点击率): 物品的历史点击率，范围通常在 0.01-0.5
- **`item_cvr`** (转化率): 物品的历史转化率，范围通常在 0.001-0.1
- **`item_price`** (价格): 物品的价格，范围通常在 10-200

#### 2. 用户特征（user_*）
- **`user_age`** (年龄): 用户年龄，范围通常在 18-60
- **`user_gender`** (性别): 用户性别，0=未知，1=男，2=女

#### 3. 交叉特征（cross_*）
- **`cross_age_x_ctr`**: 年龄 × CTR 交叉特征，用于捕捉年龄与点击率的交互效应
- **`cross_gender_x_price`**: 性别 × 价格交叉特征，用于捕捉性别与价格的交互效应

### 标签列

- **`label`**: 二分类标签（0 或 1）
  - `1`: 用户点击/转化了该物品
  - `0`: 用户未点击/转化该物品

### 数据示例

```csv
item_ctr,item_cvr,item_price,user_age,user_gender,cross_age_x_ctr,cross_gender_x_price,label
0.15,0.08,99.0,25.0,1.0,3.75,99.0,1
0.12,0.05,150.0,30.0,2.0,3.6,300.0,0
0.08,0.03,200.0,45.0,1.0,3.6,200.0,0
0.20,0.10,50.0,22.0,0.0,4.4,0.0,1
...
```

**说明**: 
- `user_gender=0`: 未知
- `user_gender=1`: 男
- `user_gender=2`: 女

## 预测目标

### 问题类型

这是一个 **二分类问题**，用于预测用户对某个物品的点击/转化概率。

### 模型配置

- **模型类型**: XGBoost 二分类模型
- **目标函数**: `binary:logistic`（逻辑回归）
- **输出**: 0-1 之间的概率分数
  - 接近 **1.0**: 用户更可能点击/转化该物品
  - 接近 **0.0**: 用户不太可能点击/转化该物品

### 训练过程

1. **数据生成**（如果数据文件不存在）:
   - 自动生成 1000 个示例样本
   - 使用随机数生成器（seed=42）确保可复现

2. **标签生成逻辑**:
   ```python
   label = (
       0.5 * item_ctr * 10 +                    # CTR 权重最高
       0.3 * item_cvr * 20 +                    # CVR 次之
       0.1 * user_age / 100 +                   # 年龄影响较小
       0.05 * user_gender / 2.0 +               # 性别影响最小（归一化到0-1范围）
       随机噪声                                 # 增加数据真实性
   )
   # 转换为二分类：label > 0.5 则为 1，否则为 0
   # 注意：user_gender 值为 0=未知，1=男，2=女，除以2.0归一化
   ```

3. **数据切分**:
   - 训练集: 80%
   - 验证集: 20%
   - 使用分层抽样（stratify）确保类别分布一致

4. **模型训练**:
   - 使用 XGBoost 进行训练
   - 支持早停（early stopping）防止过拟合
   - 评估指标: logloss

## 实际应用场景

### 在推荐系统中的使用

1. **输入**: 
   - 用户特征（年龄、性别）
   - 物品特征（CTR、CVR、价格）
   - 交叉特征（年龄×CTR、性别×价格）

2. **输出**: 
   - 用户对该物品的点击/转化概率分数（0-1 之间）

3. **用途**: 
   - 用于推荐排序：分数高的物品排在前面
   - 帮助系统选择最可能被用户点击/转化的物品

### 预测接口示例

#### 批量预测请求

```json
{
  "features_list": [
    {
      "item_ctr": 0.15,
      "item_cvr": 0.08,
      "item_price": 99.0,
      "user_age": 25.0,
      "user_gender": 1.0,
      "cross_age_x_ctr": 3.75,
      "cross_gender_x_price": 99.0
    },
    {
      "item_ctr": 0.12,
      "item_cvr": 0.05,
      "item_price": 150.0,
      "user_age": 30.0,
      "user_gender": 2.0,
      "cross_age_x_ctr": 3.6,
      "cross_gender_x_price": 300.0
    }
  ]
}
```

#### 批量预测响应

```json
{
  "scores": [0.85, 0.42]
}
```

## 使用自己的数据

### 准备数据文件

1. 创建 CSV 文件，包含以下列：
   - 特征列：`item_ctr`, `item_cvr`, `item_price`, `user_age`, `user_gender`, `cross_age_x_ctr`, `cross_gender_x_price`
   - 标签列：`label`（0 或 1）

2. 将数据文件放到 `python/data/` 目录下

3. 运行训练脚本：
   ```bash
   python train/train_xgb.py
   ```

### 数据要求

- **格式**: CSV 文件
- **编码**: UTF-8
- **必需列**: 所有特征列 + `label` 列
- **数据类型**: 
  - 数值特征：浮点数或整数
  - 标签：整数（0 或 1）
- **缺失值**: 建议在训练前处理缺失值，或确保数据完整

### 特征工程建议

1. **特征缩放**: 如果特征量纲差异大，可以使用 `--normalize` 参数启用特征标准化
2. **交叉特征**: 可以根据业务需求添加更多交叉特征
3. **特征选择**: 可以通过特征重要性分析，移除不重要的特征

## 模型评估

训练完成后，模型会在验证集上自动评估：

- **准确率** (Accuracy): 预测正确的样本比例
- **平均预测值**: 所有样本的平均预测分数

## 总结

- **训练数据**: CSV 格式，包含 7 个特征列和 1 个标签列
- **预测目标**: 二分类问题，预测用户点击/转化概率
- **模型输出**: 0-1 之间的概率分数，用于推荐排序
- **应用场景**: 推荐系统中的物品排序和个性化推荐
