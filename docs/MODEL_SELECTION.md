# 模型选型指南

本文档提供了推荐系统中不同阶段（召回、排序、重排）的模型选型参考，帮助开发者根据业务场景选择最适合的模型。

## 模型选型表格

| 阶段 | 模型名称 | 方法分类 | 适用场景 | 核心优点 | 核心缺点 | 输入 (Inputs) | 输出 (Outputs) | 开发者选型建议 |
|------|---------|---------|---------|---------|---------|--------------|--------------|--------------|
| 召回 | 双塔模型 (Two-Tower) | 向量匹配 | 大规模初筛、跨域召回 | 线上极速：Item 向量可预计算存入 Redis/Faiss，Golang 仅需做向量点积 | 交叉缺失：无法捕捉 User 和 Item 之间的细粒度特征交互 | 用户特征、物品特征 | 相似度分数或 Embedding 向量 | 追求 QPS 高、低延迟的系统首选，是工业界召回的底座 |
| 召回 | YouTube DNN | 极大规模分类 | 视频、内容流召回 | 兴趣捕获：将推荐建模为分类问题，利用 Softmax 捕捉全局兴趣 | 冷启动瓶颈：对新用户或新物品的建模依赖大量历史行为 | 用户历史序列、用户属性特征 | 用户向量 Vu (用于检索) | 适合内容丰富、用户行为历史长的平台 |
| 召回 | DSSM | 语义匹配 | 搜索推荐、相关词匹配 | 语义表征：语义对齐能力极强，非常适合 Query-Doc 的模糊匹配 | 训练数据要求高：需要高质量的负采样和大量的正样本对 | Query 特征、Doc 特征 | 语义相似度分数 | 搜索系统中的相关性召回或语义补充 |
| 召回 | GraphSAGE / Node2vec | 图表征学习 | 社交推荐、关注页召回 | 通过"关注"和"被关注"构建社交图谱，将用户映射为 Embedding，寻找拓扑结构相近的人 | 需要构建和维护图结构，计算复杂度较高 | 用户关注关系图 | 用户 Embedding 向量 | PyTorch (训练) + Golang (推理) |
| 召回 | 协同过滤 (User-CF) | 协同相似度 | 关注页、相似用户推荐 | 推荐"和你关注了相同博主"的其他用户，计算简单高效 | 冷启动问题，稀疏性问题 | 用户关注矩阵 | 相似用户列表 | Golang (计算) |
| 召回 | 二度人脉 (FOAF) | 规则统计 | 关注页扩展推荐 | 推荐"你关注的人也关注了的人"，基于社交关系链 | 容易产生信息茧房，推荐多样性不足 | 用户关注关系 | 二度人脉用户列表 | Golang |
| 召回 | 双塔模型 (U2U-DSSM) | 向量化表征 | 关注页个性化召回 | 左塔为用户特征，右塔为潜在博主特征，计算匹配度 | 需要大量训练数据，特征工程要求高 | 用户特征、博主特征 | 匹配度分数 | PyTorch (训练) |
| 排序 | DeepFM | 特征自动交叉 | CTR 预估、广告打分 | 高低阶兼顾：FM 处理二阶交互，DNN 处理高阶非线性，无需手动交叉特征 | 特征域复杂：当 Categorical 特征维度过高时，FM 部分计算压力大 | 离散 ID (Sparse) + 数值 (Dense) | 点击概率 (CTR 预测值) | 通用型最强，是精排阶段的稳健 "baseline" |
| 排序 | DIN | 序列注意力 | 电商/视频精排 | 动态兴趣：引入 Attention 机制，根据当前物品动态激活用户的历史兴趣 | 计算开销大：需要实时提取历史序列进行计算，对线上算力有要求 | 物品特征 + 用户历史行为序列 | 针对特定物品的点击概率 | 适用于用户兴趣多变（如淘宝"猜你喜欢"）的场景 |
| 重排 | MMoE | 多目标学习 | 多业务指标对齐 | 目标联合优化：通过专家网络解决"看而不点"或"点而不转"的冲突目标 | 参数量大：结构复杂，训练稳定性较难控制 | 全量共享特征 | 多个预测值 (如：点击、时长、收藏) | 需要平衡多个业务指标（如 GMV vs 时长）时必选 |

## 选型决策流程

### 1. 确定推荐阶段

- **召回阶段**：从海量候选集中快速筛选出候选物品（通常从百万级到千级）
- **排序阶段**：对召回结果进行精确打分排序（通常从千级到百级）
- **重排阶段**：在排序基础上进行多样性、多目标优化（通常从百级到最终展示数量）

### 2. 评估业务场景

- **数据规模**：用户量、物品量、行为数据量
- **实时性要求**：QPS、延迟要求
- **特征丰富度**：是否有用户历史序列、物品特征等
- **业务目标**：单目标（如 CTR）还是多目标（如 CTR + 时长 + GMV）

### 3. 技术约束

- **计算资源**：线上推理算力、存储资源
- **数据质量**：训练数据量、负采样质量
- **工程复杂度**：模型部署、特征服务能力

## 快速选型建议

### 召回阶段

- **首选**：双塔模型 (Two-Tower) - 工业界标准，性能最优
- **内容平台**：YouTube DNN - 适合内容流场景
- **搜索场景**：DSSM - 语义匹配能力强

### 排序阶段

- **通用场景**：DeepFM - 稳健的 baseline，特征自动交叉
- **电商/视频**：DIN - 动态兴趣建模，适合用户兴趣多变的场景

### 重排阶段

- **多目标优化**：MMoE - 解决多业务指标冲突问题

## 关注页推荐实践

### 召回阶段 (Recall)

#### 全量拉取 (Push/Pull Model)

- **Golang 实现**：从 Redis 或分布式数据库中拉取用户关注列表（Follow List）中博主最近发布的 Feed 流
- **特点**：此时不需要复杂的深度模型，重点在于 Golang 处理高并发 I/O 的能力
- **适用场景**：关注页基础召回，保证用户能看到关注博主的最新内容

#### 关注常用召回方法

| 模型/方法 | 模型方法分类 | 核心逻辑 | 建议语言 |
|----------|------------|---------|---------|
| GraphSAGE / Node2vec | 图表征学习 | 通过"关注"和"被关注"构建社交图谱，将用户映射为 Embedding，寻找拓扑结构相近的人 | PyTorch (训练) |
| 协同过滤 (User-CF) | 协同相似度 | 推荐"和你关注了相同博主"的其他用户 | Golang (计算) |
| 二度人脉 (FOAF) | 规则统计 | 推荐"你关注的人也关注了的人" | Golang |
| 双塔模型 (U2U-DSSM) | 向量化表征 | 左塔为用户特征，右塔为潜在博主特征，计算匹配度 | PyTorch |

### 排序阶段 (Ranking)

即使是关注页，也需要排序（而非纯时间序），否则用户关注多后会造成信息过载。

#### Edge Weighting (亲密度模型)

- **核心参数**：用户与博主的互动频率（点赞、私信、访问主页次数）
- **计算方式**：利用 Golang 做轻量级加权计算：$Weight = \sum (Action_i \times Decay_{time})$
- **优势**：计算简单，实时性好，适合高并发场景

#### 精排模型 (DeepFM/DIN)

- **个性化特征**：将"是否已关注该博主"作为一个强偏好特征（Strong Signal）输入模型
- **DIN 的应用**：通过 DIN 捕获用户在关注列表里的瞬时兴趣（比如虽然关注了 100 人，但现在最想看其中"数码博主"的内容）
- **实现建议**：
  - 在特征拼接阶段，实时查询用户的关注状态
  - 使用 `is_following` 布尔特征或 `follow_count` 数值特征增强模型

### 关注行为在"猜你喜欢"中的反馈

关注行为是最高级别的个性化信号。

#### 特征增强 (Feature Engineering)

- 在 DeepFM 或 MMoE 模型中，增加一个 `is_following` 的布尔特征或 `follow_count` 数值特征
- **Golang 实现**：在特征拼接阶段，实时查询用户的关注状态

#### 正向偏好放大

- 如果用户关注了某博主，在"猜你喜欢"全局推荐中，该博主发布的视频/文章应获得额外的权重系数（Weight Boost）
- **实现方式**：
  ```go
  if isFollowing {
      item.Score *= 1.5  // 关注博主的内容权重提升 50%
  }
  ```

## 选型口诀

> **量大快跑选双塔（召回）**  
> **不知道选啥选 DeepFM（精排）**  
> **历史行为多用 DIN（提升精准度）**  
> **又要点击又要买选 MMoE（重排）**

## 相关文档

- [召回算法文档](./RECALL_ALGORITHMS.md) - 详细的召回算法实现说明
- [排序模型文档](./RANK_MODELS.md) - 详细的排序模型实现说明
- [架构设计文档](./ARCHITECTURE.md) - 系统整体架构说明
